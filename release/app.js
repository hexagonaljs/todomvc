var CompleteTasksUseCase,LocalStorage,RoutingAdapter,StatsView,Task,TodoListView,WebGlue,WebTodoApp,__hasProp={}.hasOwnProperty,__bind=function(a,b){return function(){return a.apply(b,arguments)}};_.defaults(this,{Before:function(a,b,c){return YouAreDaBomb(a,b).before(c)},BeforeAnyCallback:function(a,b,c){return YouAreDaBomb(a,b).beforeAnyCallback(c)},After:function(a,b,c){return YouAreDaBomb(a,b).after(c)},Around:function(a,b,c){return YouAreDaBomb(a,b).around(c)},AfterAll:function(a,b,c){var d,e,f,g;g=[];for(e=0,f=b.length;e<f;e++)d=b[e],g.push(After(a,d,c));return g},LogAll:function(a,b){var c,d,e;b==null&&(b=""),e=[];for(c in a){if(!__hasProp.call(a,c))continue;d=a[c],_.isFunction(d)?e.push(function(c){return Before(a,c,function(){return console.log(""+b+": "+c)})}(c)):e.push(void 0)}return e},AutoBind:function(a,b){var c,d,e;e=[];for(c in a)d=a[c],_.isFunction(d)?e.push(function(c){if(c.endsWith("Clicked")&&b[c.remove("Clicked")])return After(a,c,function(a){return b[c.remove("Clicked")](a)})}(c)):e.push(void 0);return e}}),LocalStorage=function(){function a(a){this.namespace=a,this.flush=__bind(this.flush,this),this.remove=__bind(this.remove,this),this.newTask=__bind(this.newTask,this),this.getTasks=__bind(this.getTasks,this),this.get=__bind(this.get,this),this.set=__bind(this.set,this)}return a.prototype.set=function(a,b){return console.log(b),$.jStorage.set(""+this.namespace+"/"+a,b)},a.prototype.get=function(a){return $.jStorage.get(""+this.namespace+"/"+a)},a.prototype.getTasks=function(){var a=this;return this.get("tasks").map(function(b){var c;return c=a.newTask(b.content,b.completed),c})},a.prototype.newTask=function(a,b){var c;return c=new Task(a),c.completed=b,c},a.prototype.remove=function(a){return $.jStorage.deleteKey(""+this.namespace+"/"+a)},a.prototype.flush=function(){var a,b,c,d,e;d=$.jStorage.index(),e=[];for(b=0,c=d.length;b<c;b++)a=d[b],a.match("^"+this.namespace)?e.push($.jStorage.deleteKey(a)):e.push(void 0);return e},a}(),CompleteTasksUseCase=function(){function a(){this.clearCompleted=__bind(this.clearCompleted,this),this.uncompleteTask=__bind(this.uncompleteTask,this),this.completeTask=__bind(this.completeTask,this),this.toggleTaskCompletion=__bind(this.toggleTaskCompletion,this),this.completeAllTasks=__bind(this.completeAllTasks,this),this.deleteTask=__bind(this.deleteTask,this),this.updateTaskContent=__bind(this.updateTaskContent,this),this.editTaskContent=__bind(this.editTaskContent,this),this.addNewTask=__bind(this.addNewTask,this),this.showCompleted=__bind(this.showCompleted,this),this.showActive=__bind(this.showActive,this),this.showAll=__bind(this.showAll,this),this.setInitialTasks=__bind(this.setInitialTasks,this),this.remainingTasks=__bind(this.remainingTasks,this),this.completedTasks=__bind(this.completedTasks,this),this.start=__bind(this.start,this),this.todoTasks=[]}return a.prototype.start=function(){},a.prototype.completedTasks=function(){return this.todoTasks.filter(function(a){return a.completed})},a.prototype.remainingTasks=function(){return this.todoTasks.filter(function(a){return!a.completed})},a.prototype.setInitialTasks=function(a){return this.todoTasks=a},a.prototype.showAll=function(){},a.prototype.showActive=function(){},a.prototype.showCompleted=function(){},a.prototype.addNewTask=function(a){return this.todoTasks.push(a)},a.prototype.editTaskContent=function(a){},a.prototype.updateTaskContent=function(a,b){return a.content=b},a.prototype.deleteTask=function(a){return this.todoTasks.remove(a)},a.prototype.completeAllTasks=function(){var a=this;return this.todoTasks.map(function(b){return a.completeTask(b)})},a.prototype.toggleTaskCompletion=function(a){return a.completed?this.uncompleteTask(a):this.completeTask(a)},a.prototype.completeTask=function(a){return a.complete()},a.prototype.uncompleteTask=function(a){return a.uncomplete()},a.prototype.clearCompleted=function(){var a=this;return this.completedTasks().each(function(b){return a.deleteTask(b)})},a}(),Task=function(){function a(a,b){this.content=a,this.completed=b!=null?b:!1,this.uncomplete=__bind(this.uncomplete,this),this.complete=__bind(this.complete,this)}return a.prototype.complete=function(){return this.completed=!0},a.prototype.uncomplete=function(){return this.completed=!1},a}(),TodoListView=function(){function a(){this.enterKeyPressed=__bind(this.enterKeyPressed,this),this.newTodoContent=__bind(this.newTodoContent,this),this.clearNewTodoTextBox=__bind(this.clearNewTodoTextBox,this),this.keyPressed=__bind(this.keyPressed,this),this.toggleTaskCompletionClicked=__bind(this.toggleTaskCompletionClicked,this),this.completeAllTasksClicked=__bind(this.completeAllTasksClicked,this),this.showTasks=__bind(this.showTasks,this),this.uncompleteTask=__bind(this.uncompleteTask,this),this.completeTask=__bind(this.completeTask,this),this.updateTaskContent=__bind(this.updateTaskContent,this),this.enterKeyPressedWhenEditing=__bind(this.enterKeyPressedWhenEditing,this),this.editingKeyPressed=__bind(this.editingKeyPressed,this),this.editTaskContent=__bind(this.editTaskContent,this),this.deleteTask=__bind(this.deleteTask,this),this.deleteTaskClicked=__bind(this.deleteTaskClicked,this),this.taskContentDoubleClicked=__bind(this.taskContentDoubleClicked,this),this.findTaskElement=__bind(this.findTaskElement,this),this.addNewTask=__bind(this.addNewTask,this),this.createElementFor=__bind(this.createElementFor,this);var a=this;$("#new-todo").keypress(function(b){return a.keyPressed(b)}),$("#toggle-all").click(function(){return a.completeAllTasksClicked()}),this.taskElements=[]}return a.prototype.createElementFor=function(a,b){var c,d,e,f,g;return f=$(b).html(),g=Handlebars.compile(f),c={content:a.content,completed:a.completed},e=g(c),d=$(e)},a.prototype.addNewTask=function(a){var b,c=this;return b=this.createElementFor(a,"#todo-template"),b.task=a,this.taskElements.push(b),$("#todo-list").prepend(b),b.find(".destroy").click(function(){return c.deleteTaskClicked(a)}),b.find(".toggle").click(function(){return c.toggleTaskCompletionClicked(a)}),b.dblclick(function(){return c.taskContentDoubleClicked(a)})},a.prototype.findTaskElement=function(a){return this.taskElements.find(function(b){return b.task===a})},a.prototype.taskContentDoubleClicked=function(a){},a.prototype.deleteTaskClicked=function(a){},a.prototype.deleteTask=function(a){return this.findTaskElement(a).remove()},a.prototype.editTaskContent=function(a){var b,c=this;return b=this.findTaskElement(a),b.addClass("editing").find("input.edit").show().select().focus(),b.find("input.edit").keypress(function(a){return c.editingKeyPressed(a,b)})},a.prototype.editingKeyPressed=function(a,b){var c;c=13;if(a.keyCode===c)return this.enterKeyPressedWhenEditing(b.task,b.find("input.edit").val())},a.prototype.enterKeyPressedWhenEditing=function(a,b){},a.prototype.updateTaskContent=function(a,b){var c;return c=this.findTaskElement(a),c.removeClass("editing").find("input.edit").hide(),c.find("label").html(b)},a.prototype.completeTask=function(a){var b;return b=this.findTaskElement(a),b.addClass("completed"),b.find("input.toggle").attr("checked","checked")},a.prototype.uncompleteTask=function(a){var b;return b=this.findTaskElement(a),b.removeClass("completed"),b.find("input .toggle").attr("checked","")},a.prototype.showTasks=function(a){var b,c,d,e;$("#todo-list").html(""),e=[];for(c=0,d=a.length;c<d;c++)b=a[c],e.push(this.addNewTask(b));return e},a.prototype.completeAllTasksClicked=function(){},a.prototype.toggleTaskCompletionClicked=function(a){},a.prototype.keyPressed=function(a){var b;b=13;if(a.keyCode===b)return this.enterKeyPressed(this.newTodoContent()),this.clearNewTodoTextBox()},a.prototype.clearNewTodoTextBox=function(){return $("#new-todo").val("")},a.prototype.newTodoContent=function(){return $("#new-todo").val()},a.prototype.enterKeyPressed=function(a){},a}(),StatsView=function(){function a(){this.clearCompletedClicked=__bind(this.clearCompletedClicked,this),this.remainingTasksClicked=__bind(this.remainingTasksClicked,this),this.completedTasksClicked=__bind(this.completedTasksClicked,this),this.allTasksClicked=__bind(this.allTasksClicked,this),this.selectCompleted=__bind(this.selectCompleted,this),this.selectActive=__bind(this.selectActive,this),this.selectAll=__bind(this.selectAll,this),this.clearPreviousSelection=__bind(this.clearPreviousSelection,this),this.showStats=__bind(this.showStats,this)}return a.prototype.showStats=function(a,b){var c,d,e,f,g,h,i=this;return g=$("#stats-template").html(),h=Handlebars.compile(g),f=a>1,c={remaining:a,moreThanOne:f,completed:b},e=h(c),d=$(e),d.find("#all-tasks").click(function(){return i.allTasksClicked()}),d.find("#active-tasks").click(function(){return i.remainingTasksClicked()}),d.find("#completed-tasks").click(function(){return i.completedTasksClicked()}),$("#footer").html(d),$("#clear-completed").click(function(){return i.clearCompletedClicked()})},a.prototype.clearPreviousSelection=function(){return["#all-tasks","#active-tasks","#completed-tasks"].each(function(a){return $(a).removeClass("selected")})},a.prototype.selectAll=function(){return this.clearPreviousSelection(),$("#all-tasks").addClass("selected")},a.prototype.selectActive=function(){return this.clearPreviousSelection(),$("#active-tasks").addClass("selected")},a.prototype.selectCompleted=function(){return this.clearPreviousSelection(),$("#completed-tasks").addClass("selected")},a.prototype.allTasksClicked=function(){},a.prototype.completedTasksClicked=function(){},a.prototype.remainingTasksClicked=function(){},a.prototype.clearCompletedClicked=function(){},a}(),RoutingAdapter=function(){function a(){this.showActive=__bind(this.showActive,this),this.showCompleted=__bind(this.showCompleted,this),this.showAll=__bind(this.showAll,this),this.setUrlToCompleted=__bind(this.setUrlToCompleted,this),this.setUrlToActive=__bind(this.setUrlToActive,this),this.setUrlToAll=__bind(this.setUrlToAll,this),this.start=__bind(this.start,this);var a,b=this;a={"/":function(){return b.showAll()},"/active":function(){return b.showActive()},"/completed":function(){return b.showCompleted()}},this.router=Router(a)}return a.prototype.start=function(){return this.router.init()},a.prototype.setUrlToAll=function(){return this.router.setRoute("/")},a.prototype.setUrlToActive=function(){return this.router.setRoute("/active")},a.prototype.setUrlToCompleted=function(){return this.router.setRoute("/completed")},a.prototype.showAll=function(){},a.prototype.showCompleted=function(){},a.prototype.showActive=function(){},a}(),WebGlue=function(){function a(a,b,c,d,e){var f=this;this.useCase=a,this.todoListView=b,this.statsView=c,this.storage=d,this.routingAdapter=e,this.routingGlue=__bind(this.routingGlue,this),this.statsViewGlue=__bind(this.statsViewGlue,this),this.todoListViewGlue=__bind(this.todoListViewGlue,this),this.todoListViewGlue(),this.statsViewGlue(),this.routingGlue(),After(this.useCase,"start",function(){return f.useCase.setInitialTasks(f.storage.getTasks())}),AfterAll(this.useCase,["addNewTask","updateTaskContent","deleteTask","completeAllTasks","toggleTaskCompletion"],function(){return f.storage.set("tasks",f.useCase.todoTasks)}),LogAll(this.useCase,"UseCase"),LogAll(this.todoListView,"TodoListView"),LogAll(this.statsView,"StatsView"),LogAll(this.routingAdapter,"Router")}return a.prototype.todoListViewGlue=function(){var a=this;return AutoBind(this.todoListView,this.useCase),After(this.todoListView,"enterKeyPressed",function(b){return a.useCase.addNewTask(new Task(b))}),After(this.todoListView,"taskContentDoubleClicked",this.useCase.editTaskContent),After(this.todoListView,"enterKeyPressedWhenEditing",this.useCase.updateTaskContent),After(this.useCase,"addNewTask",this.todoListView.addNewTask),After(this.useCase,"showAll",function(){return a.todoListView.showTasks(a.useCase.todoTasks)}),After(this.useCase,"deleteTask",this.todoListView.deleteTask),After(this.useCase,"completeTask",this.todoListView.completeTask),After(this.useCase,"uncompleteTask",this.todoListView.uncompleteTask),After(this.useCase,"editTaskContent",this.todoListView.editTaskContent),After(this.useCase,"updateTaskContent",this.todoListView.updateTaskContent),After(this.useCase,"showActive",function(){return a.todoListView.showTasks(a.useCase.remainingTasks())}),After(this.useCase,"showCompleted",function(){return a.todoListView.showTasks(a.useCase.completedTasks())})},a.prototype.statsViewGlue=function(){var a=this;return AfterAll(this.useCase,["addNewTask","deleteTask","completeAllTasks","toggleTaskCompletion","showAll","showCompleted","showActive"],function(){return a.statsView.showStats(a.useCase.remainingTasks().length,a.useCase.completedTasks().length)}),After(this.statsView,"allTasksClicked",function(){return a.useCase.showAll()}),After(this.statsView,"completedTasksClicked",function(){return a.useCase.showCompleted()}),After(this.statsView,"remainingTasksClicked",function(){return a.useCase.showActive()}),After(this.statsView,"clearCompletedClicked",function(){return a.useCase.clearCompleted()}),After(this.useCase,"showCompleted",function(){return a.statsView.selectCompleted()}),After(this.useCase,"showAll",function(){return a.statsView.selectAll()}),After(this.useCase,"showActive",function(){return a.statsView.selectActive()})},a.prototype.routingGlue=function(){var a=this;return After(this.routingAdapter,"showAll",function(){return a.useCase.showAll()}),After(this.routingAdapter,"showCompleted",function(){return a.useCase.showCompleted()}),After(this.routingAdapter,"showActive",function(){return a.useCase.showActive()}),After(this.useCase,"showAll",function(){return a.routingAdapter.setUrlToAll()}),After(this.useCase,"showActive",function(){return a.routingAdapter.setUrlToActive()}),After(this.useCase,"showCompleted",function(){return a.routingAdapter.setUrlToCompleted()})},a}(),WebTodoApp=function(){function a(){var a,b,c,d,e,f;f=new CompleteTasksUseCase,f.start(),window.useCase=f,e=new TodoListView,d=new StatsView,b=new LocalStorage("todo_app"),c=new RoutingAdapter,a=new WebGlue(f,e,d,b,c),f.start(),c.start()}return a}(),new WebTodoApp